
<div class="content-wrapper">
  <!-- Content Header (Page header) -->
  <section class="content-header">
    <h1>
      Businesses
    </h1>

    <ol class="breadcrumb">
      <i class="fa fa-dashboard"></i>
      <%= render_breadcrumbs :tag => :li %>
      <!-- <li class="active">Business</li> -->
    </ol>
  </section>

  <!-- Main content -->
  <section class="content">
    <div class="row">
      <div class="col-xs-12">
        <div class="box box-primary">
          <div class="box-header">
            <h3 class="box-title">All Businesses</h3>
            <p style= "color:green;" id="notice"><%= flash[:notice] %></p>
          </div>
          <!-- /.box-header -->
          <div class="box-body">
            <div class="row">
              <div class="col-md-12">
                <div class="form-group filter-con">
                  <label>Filters</label>
                  <div class="col-md-3">
                    <%= form_tag  list_business_list_path, :method => :get, :class => "login-form"  do%>

                        <select id="states-of-country" name="project[state]" class="form-control">
                          <option id="no-state" value="" selected="">Select Your State</option>

                          /* For states within IN */
                          <% selected_val = '' %>
                          <% if params[:project].present? %>
                              <% selected_val = params[:project][:state] unless params[:project][:state].nil? %>
                          <% end %>

                          <%= options_for_select(customise_state(CS.states(:in)), selected_val )  %>


                        </select>
                        </div>
                        <div class="col-md-3">
                          <select id="cities-of-state" name="project[city]" class="form-control">
                            <option value="" selected>Select Your City</option>
                          </select>

                        </div>
                        <div class="col-md-2">
                          <%= submit_tag "Filter", class: "btn btn-large btn-primary btns" %>
                        </div>

                        <%= link_to "/list/business_list", class: "btn btn-default pull-right" do %>Clear Filter
                        <%end%>
                    <% end %>
                    </div>
              </div>
            </div>
            <div class="table-responsive">
              <table id="companies" class="display" data-source="<%= list_business_list_path(format: :json) %>">
                <thead>
                <tr>
                  <th>Sr. No</th>
                  <th>Business Name</th>
                  <th>Owner</th>
                  <th>No. of Locations</th>
                  <th>No. of Proessionals</th>
                  <th>Earning($)</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
                </thead>

                <tbody>

                </tbody>
              </table>

            </div>
            <!--responsive-->
          </div>
          <!-- /.box-body -->
        </div>
        <!-- /.box -->
      </div>
      <!-- /.col -->
    </div>
    <!-- /.row -->
  </section>
  <!-- /.content -->
</div>


<div id="SmsModal">

</div>



<script>

    function icheck(){
        if($(".icheck-me").length > 0){
            $(".icheck-me").each(function(){
                var $el = $(this);
                var skin = ($el.attr('data-skin') !== undefined) ? "_" + $el.attr('data-skin') : "",
                        color = ($el.attr('data-color') !== undefined) ? "-" + $el.attr('data-color') : "";
                var opt = {
                    checkboxClass: 'icheckbox' + skin + color,
                    radioClass: 'iradio' + skin + color
                }
                $el.iCheck(opt);
            });
        }
    }

    $(function(){
        icheck();
    })


    $(document).on('change', '#states-of-country', function(e) {
        var cities_of_state, input_state, state;
        input_state = $(this);
        cities_of_state = $('#cities-of-state');
        state = this.options[e.target.selectedIndex].id;
        if (state === 'no-state') {
            return cities_of_state.html('');
        } else {
            // val = $(this).children(':selected').attr("value") ;
            // $(this).children(':selected').attr('id' , val) ;
            $.ajax({

                url: '/cities/' + $(this).children(':selected').attr('id'),
                success: function(data) {
                    var opt;
                    opt = '<option value="" selected>Select Your City</option>';
                    if (data.length === 0) {

                    } else {
                        data.forEach(function(i) {
                            opt += '<option value="' + i + '">' + i + '</option>';
                        });
                        cities_of_state.html(opt);
                    }
                }
            });
        }
    });

    $("#notice" ).fadeOut(5000);

    jQuery(document).ready(function() {
        $('#companies').dataTable({
            "language": {
                "processing": "<img src='../assets/reload.gif'>"
            },
            "processing": true,
            "serverSide": true,
            "ajax": $('#companies').data('source'),
            "pagingType": "full_numbers",
            'columns': [
                { 'sortable': true, 'searchable': true },
                { 'sortable': true, 'searchable': true },
                { 'sortable': true, 'searchable': true },
                { 'sortable': true, 'searchable': true },
                { 'sortable': true, 'searchable': true },
                { 'sortable': true, 'searchable': true },
                { 'sortable': false, 'searchable': false },
                { 'sortable': false, 'searchable': false }
            ]
        });
    });

    function open_edit_form(id) {
        window.location.href = "/business/" + id + "/details"
    }

    function sms_edit(id) {
        $.ajax({
            type: 'POST',
            url: '/business/sms_credit_popup',
            data: {id: id },
            dataType: 'script'
        });
    }

</script>

