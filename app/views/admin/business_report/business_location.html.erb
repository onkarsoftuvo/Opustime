<div class="content-wrapper">
  <!-- Content Header (Page header) -->
  <section class="content-header">
    <h1>
      Businesses
    </h1>
    <ol class="breadcrumb">
      <i class="fa fa-dashboard"></i>
      <%= render_breadcrumbs :tag => :li %>
      <!-- <li><i class="fa fa-dashboard"></i> Home</li>
      <li class="active">Business</li> -->
    </ol>
  </section>

  <!-- Main content -->
  <section class="content">
    <div class="row">
      <div class="col-xs-12">

        <div class="box box-primary">
          <div class="box-header">
            <h3 class="box-title">Top Earning Location</h3>
          </div>
          <!-- /.box-header -->
          <div class="box-body">
            <div class="row">
              <div class="col-md-12">
                <div class="form-group filter-con">
                  <label>Filters</label>
                  <div class="col-md-3">
                    <%= form_tag  earn_business_location_path, :method => :get, :class => "login-form"  do%>

                        <select id="states-of-country" name="project[state]" class="form-control">
                          <option id="no-state" value="" selected>Select Your State</option>

                          /* For states within IN */
                          <% selected_val = "" %>
                          <% if params[:project].present? %>
                              <% selected_val = params[:project][:state] unless params[:project][:state].nil? %>
                          <% end %>

                          <%= options_for_select(customise_state(CS.states(:in)), selected_val )  %>
                        </select>
                        </div>
                        <div class="col-md-3">
                          <select id="cities-of-state" name="project[city]" class="form-control">
                            <option value="" selected>Select Your City</option>
                          </select>

                        </div>
                        <div class="col-md-2">
                          <%= submit_tag "Filter", class: "btn btn-large btn-primary btns" %>
                        </div>

                        <!-- <div class="col-md-2 pull-right text-right">
                          <button class="btn btn-default">Clear Filter</button>
                        </div> -->
                        <%= link_to "/earn/business_location", class: "btn btn-default pull-right" do %>Clear Filter
                        <%end%>
                    <% end %>
                    </div>
              </div>
            </div>
            <table id="example1" class="table table-bordered custom_table">
              <thead>
              <tr>
                <th>Sr. No</th>
                <th>Location Name</th>
                <th>Business Name</th>
                <th>Earning</th>
                <!-- <th>Total New Customer Last Month</th> -->
                <!-- <th class="no_sort text-center">Actions</th> -->
              </tr>
              </thead>
              <tbody>

              <% @company.each_with_index do |comp , index| %>
                  <% comp.businesses.each_with_index do |business , bs_index| %>
                      <tr>
                        <td><%= "#{index+1}.#{bs_index+1}" %></td>
                        <td><%= business.name %></td>
                        <td><%= comp.company_name %></td>
                        <td><%= business.get_revenue_collection_business %></td>
                      </tr>
                  <% end %>
              <% end %>

              </tbody>
            </table>
          </div>
          <!-- /.box-body -->
        </div>
        <!-- /.box -->
      </div>
      <!-- /.col -->
    </div>
    <!-- /.row -->
  </section>
  <!-- /.content -->
</div>



<script>
  $(function () {
    $("#example1").DataTable();
//    $('#example2').DataTable({
//      "paging": true,
//      "lengthChange": false,
//      "searching": false,
//      "ordering": true,
//      "info": true,
//      "autoWidth": false
//    });
 });


  $(document).on('change', '#states-of-country', function(e) {
  var cities_of_state, input_state, state;
  input_state = $(this);
  cities_of_state = $('#cities-of-state');
  state = this.options[e.target.selectedIndex].id;
  if (state === 'no-state') {
    return cities_of_state.html('');
  } else {
    $.ajax({
      url: '/cities/' + $(this).children(':selected').attr('id'),
      success: function(data) {
        var opt;
        opt = '<option value="" selected>Select Your City</option>';
        if (data.length === 0) {

        } else {
          data.forEach(function(i) {
            opt += '<option value="' + i + '">' + i + '</option>';
          });
          cities_of_state.html(opt);
        }
      }
    });
  }
});
  $(document).ready(function() {
      var t = $('#top_earn').DataTable( {
          "columnDefs": [ {
              "searchable": false,
              "orderable": false,
              "targets": 0
          } ],
          "order": [[ 1, 'asc' ]]
      } );

      t.on( 'order.dt search.dt', function () {
          t.column(0, {search:'applied', order:'applied'}).nodes().each( function (cell, i) {
              cell.innerHTML = i+1;
          } );
      } ).draw();
  } );
  $.fn.dataTable.ext.errMode = 'throw';
</script>
